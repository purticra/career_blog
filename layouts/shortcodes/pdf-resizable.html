{{- $file := .Get "file" -}}
{{- $minHeight := .Get "minHeight" | default "400" -}}
{{- $defaultHeight := .Get "height" | default "600" -}}
{{- $maxWidth := .Get "maxWidth" | default "1200" -}}

<div class="pdf-resizable-wrapper" style="max-width: {{ $maxWidth }}px; margin: 2rem auto;">
  <div class="pdf-resizable-container" data-min-height="{{ $minHeight }}" style="position: relative; height: {{ $defaultHeight }}px;">
    <iframe 
      src="{{ $file }}" 
      class="pdf-iframe"
      style="width: 100%; height: 100%; border: 1px solid #e5e7eb; border-radius: 8px; display: block;"
      type="application/pdf">
      <p style="padding: 2rem; text-align: center;">
        您的浏览器不支持 PDF 预览。
        <a href="{{ $file }}" download style="color: #3b82f6; text-decoration: underline;">
          点击下载 PDF
        </a>
      </p>
    </iframe>
    
    <!-- 调整大小手柄 -->
    <div class="pdf-resize-handle" 
         style="position: absolute; 
                bottom: 0; 
                right: 0; 
                width: 20px; 
                height: 20px; 
                cursor: nwse-resize; 
                background: linear-gradient(135deg, transparent 50%, #9ca3af 50%);
                border-bottom-right-radius: 8px;
                z-index: 10;">
    </div>
  </div>
  
  <!-- 当前高度显示 -->
  <div class="pdf-height-indicator" 
       style="text-align: center; 
              margin-top: 0.5rem; 
              font-size: 0.875rem; 
              color: #6b7280;
              display: none;">
    高度: <span class="current-height">{{ $defaultHeight }}</span>px
  </div>
</div>

<style>
.pdf-resizable-container {
  transition: box-shadow 0.3s ease;
}

.pdf-resizable-container:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.pdf-resize-handle:hover {
  background: linear-gradient(135deg, transparent 50%, #6b7280 50%);
}

.pdf-resize-handle:active {
  background: linear-gradient(135deg, transparent 50%, #4b5563 50%);
}

/* 暗色模式支持 */
@media (prefers-color-scheme: dark) {
  .pdf-iframe {
    border-color: #374151 !important;
  }
  
  .pdf-resize-handle {
    background: linear-gradient(135deg, transparent 50%, #6b7280 50%);
  }
  
  .pdf-resize-handle:hover {
    background: linear-gradient(135deg, transparent 50%, #9ca3af 50%);
  }
}

/* 响应式调整 */
@media (max-width: 768px) {
  .pdf-resizable-wrapper {
    max-width: 100% !important;
    margin: 1rem 0 !important;
  }
}
</style>

<script>
(function() {
  const containers = document.querySelectorAll('.pdf-resizable-container');
  
  containers.forEach(container => {
    const handle = container.querySelector('.pdf-resize-handle');
    const indicator = container.parentElement.querySelector('.pdf-height-indicator');
    const currentHeightSpan = container.parentElement.querySelector('.current-height');
    const minHeight = parseInt(container.dataset.minHeight) || 400;
    let isResizing = false;
    let startY = 0;
    let startHeight = 0;

    handle.addEventListener('mousedown', initResize);
    
    function initResize(e) {
      isResizing = true;
      startY = e.clientY;
      startHeight = container.offsetHeight;
      
      // 显示高度指示器
      if (indicator) {
        indicator.style.display = 'block';
      }
      
      document.addEventListener('mousemove', resize);
      document.addEventListener('mouseup', stopResize);
      
      // 防止选中文本
      e.preventDefault();
    }
    
    function resize(e) {
      if (!isResizing) return;
      
      const deltaY = e.clientY - startY;
      const newHeight = Math.max(minHeight, startHeight + deltaY);
      
      container.style.height = newHeight + 'px';
      
      // 更新高度显示
      if (currentHeightSpan) {
        currentHeightSpan.textContent = Math.round(newHeight);
      }
    }
    
    function stopResize() {
      isResizing = false;
      document.removeEventListener('mousemove', resize);
      document.removeEventListener('mouseup', stopResize);
      
      // 2秒后隐藏高度指示器
      if (indicator) {
        setTimeout(() => {
          indicator.style.display = 'none';
        }, 2000);
      }
    }
  });
})();
</script>